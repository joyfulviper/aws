<img src="https://github.com/joyfulviper/aws/assets/79970349/a3808646-a70c-4ac3-9385-570939ad345a" width="500" height="300">


- 네트워크: 인프라스트럭처 관리자가 주체가 되어 관리하는 저장소
  - 다양한 서버나 인프라스트럭처 기기, 이들을 연결하는 케이블을 네트워크 관리자가 제공한다. 그리고 네트워크 내의 기기는 서로 자유롭게 통신하며 이런 네트워크를 LAN(Local Area Network)이라 부르기로 했다.



## VPC(Amazon Virtual Private Cloud, Amazon VPC)
- 클라우드를 이용하지 않는 네트워크에서는 서버, 네트워크 장비, 이들을 연결하는 테이블 등 모두 물리적으로 구축했어야 함. 특히 고가의 네트워크 장비는 수천만원 하는 것도 있어 구축하기가 쉽지 않음
- AWS는 데이터센터에 있는 전용 기기에서 서버나 네트워크 장비가 가진 기능을 에뮬레이션하는 소프트웨어를 작동시켜, 물리적인 기기를 이용하지 않고 가상의 네트워크를 구축할 수 있게 함
  - 따라서 기기의 추가나 삭제를 소프트웨어의 실행이나 정지처럼 간단히 수행할 수 있음
  - VPC끼리는 독립적임
- 생성 내용
  - VPC를 생성할 때 사전에 네트워크 정보를 결정해야 한다.
 
| 항목  | 값   |설명 |
|-------|-------|-------|
| 이름태그   | sample-vpc   | VPC를 식별하는 이름   |
| IPv4 CIDR 블록   | 10.0.0.0/16   | VPC에서 이용하는 프라이빗 네트워크의 IPv4 주소 범위 |
| IPv6 CIDR 블록 | IPv6 CIDR 블록 없음 | VPC에서 이용하는 프라이빗 네트워크의 IPv6 주소 범위 |
| 테넌시(tenency) | 기본값 | VPC 리소스의 전용 하드웨어에서의 실행 여부 |

이제 AWS 홈페이지에 들어가 위 설정과 함께 VPC를 생성한다. 

## 서브넷과 가용 영역
- VPC 안에는 하나 이상의 서브넷을 만들어야 한다.
  - 서브넷은 VPC의 IP 주소 범위를 나누는 단위다.
    - IP 주소를 나누는 이유는 다음과 같다. **역할 분리**(외부에 공개하는 리소스 여부를 구별), **기기 분리**(AWS 안에서의 물리적인 이중화(다중화)를 수행)
    - 역할분리: 시스템을 구축할 때 여러 리소스가 필요하다. 예를 들어 로드밸런서, DB 서버가 리소스에 포함되는 요소인데 로드밸런서는 외부에 공개해야하고 DB 서버는 VPC 내부에서만 사용하므로 외부에 공개 돼서는 안된다. 이러한 이유 때문에 IP 주소를 서브넷 단위로 나누는 것이다.
    - 기기분리: 예를 들어 클라우드 서비스를 제공하는 물리적인 컴퓨터가 고장났을 경우 해당 컴퓨터에 있는 모든 리소스를 이용이 불가능하다. 이러한 문제를 방지하기 위해, 같은 서비스의 리소스를 여러 물리적 컴퓨터나 가용 영역에 분산 배치한다. 이 때 가용 영역별로 서브넷을 다르게 하여 서비스 전체가 장애나는 것을 방지할 수 있다.


## VPC의 IPv4 CIDR을 설계하기 위한 선수 지식

**IP 주소** <br>
- IPv4인 경우 항상 32비트로 구성된다.
- 네트워크 부분과 호스트 부분으로 나누어진다.
- 이때 두 부분은 서브넷 마스크에 의해 구분된다.

**CIDR**<br>
- IP주소와 서브넷 마스크를 결합한 표기법
- 예)10.0.0.0/16(뒤에 16은 서브넷 마스크를 비트로 나타낸 것)
- 예를 들어 255.255.240.0이라는 서브넷 마스크가 있다면 이진수로 변환 
->
```
255 = 11111111
255 = 11111111
240 = 11110000
0 = 00000000
```
-> 이들을 이어 붙이면 "11111111 11111111 11110000 00000000" 이를 비트로 표현하면 20비트가 된다.
<br>

**서브넷 마스크**<br>
- IP 주소에서 네트워크와 호스트를 부분을 나누는 방법
- 예를 들어 IP주소가 10.0.0.0, 서브넷 마스크가 255.255.0.0 이라고 하면 이를 CIDR로 표현하면 10.0.0.0/16이 된다. 이 중 32비트의 IPv4 주소 중 16비트는 네트워크 부분, 나머지 16비트는 호스트 부분이 된다.
- 근데 왜 서브넷 마스크냐면 호스트 비트를 갖고 서브넷을 할당할 수 있기 때문에다. 즉, 서브넷을 마스킹 할 수 있기 때문에 서브넷 마스크다.
- 예를 들어 16비트를 전부 각각의 호스트로 두어 총 2^16개의 서브넷을 만들 수 있지만 서브넷당 호스트(리소스(라우팅 장비라던지, 서버등))의 수를 적당히 분배하고 서브넷도 적당히 분리해야 한다.
- 16비트의 호스트 부분이 존재하면 서브넷당 리소스(호스트)를 8비트(2^8)씩 할당한다면 총 8비트(2^8)개의 서브넷을 생성할 수 있다.
<br>


**서브넷**<br>
- 네트워크를 네트워크로 잘게 나눈 것

## 서브넷 생성
- 외부 공개(public) 서브넷, 비공개(private) 서브넷, 가용영역1, 가용영역2를 기준으로 서브넷을 4개 생성했다.
- 생성할때 필요한 요소로 vpc id, 이름, 가용 영역, IPv4 CIDR 블록이 있다.
- 기존 VPC의 CIDR은 10.0.0.0/16이다. 나의 경우 서브넷을 4비트, 리소스를 12비트로 설정했다. 이 경우 서브넷은 총 16(2^4)개 생성할 수 있으며 각각의 IPv4 CIDR 블록은 IP주소/20으로 설정하면 된다. 20이란 서브넷 마스크 값은 다음의 근거로 나왔다. 루트 네트워크(VPC)의 네트워크 비트(16비트) + 서브넷의 비트(4비트)
- 서브넷의 IP 주소는 00001010.00000000.????XXXX.XXXXXXXX의 비트값으로 ?에 아무 값이나 넣어 할당해주면 된다. (앞선 고정된 값은 루트 네트워크(VPC)의 네트워크 주소)

## 인터넷 게이트웨이
- VPC에서 생성된 네트워크와 인터넷 사이의 통신을 가능하게 하는 입출구
- 생성 내용

|항목|값|설명|
|----|--|----|
|이름태그|sample-igw|인터넷 게이트웨이에 붙이는 이름|
|VPC|sample-vpc|인터넷 게이트웨이와 연결할 vpc|

## NAT(Network Address Translation) 게이트웨이
- Private 서브넷이 인터넷에 공개되는 것을 막기 위해 NAT 게이트웨이를 통해 private 서브넷의 address를 내보냄
- 예를 들어 private 서브넷에서 생성한 리소스는 인터넷으로 내보낼 수 있지만 인터넷에서는 private 서브넷에 접근할 수 없어야 한다. 이를 위해 private 서브넷은 NAT 게이트웨이를 통해 자신의 network address를 public 서브넷의 network address로 변환해서 내보낸다.

## 라우팅 테이블
- 현재 VPC 내에 서브넷도 만들고, 인터넷과 연결을 위해 인터넷 게이트웨이도 만들고, private 서브넷의 리소스를 밖으로 보내주기 위해 NAT 게이트웨이도 만들었다. 하지만 서브넷과 서브넷 또는 서브넷과 각 게이트웨이가 통신할 수 있는 경로가 아직 존재하지 않아 이들을 연결하게 해줄 다리가 필요하다.
- 이러한 서브넷 사이의 통신 경로를 설정하는 것을 라우팅이라고 하며 AWS의 라우팅 테이블 서비스를 이용해 라우팅을 생성할 수 있다.
- 라우팅 테이블의 대표적인 타깃

|타깃|용도|
|----|-----|
|로컬|동일 VPC 안의 리소스에 접근|
|인터넷 게이트웨이|퍼블릭 서브넷에 생성된 리소스가 인터넷 서버와 통신|
|NAT 게이트웨이|프라이빗 서브넷에 생성된 리소스가 인터넷 서버와 통신|
|VPN 게이트웨이|VPN을 통해 접속된 독자 네트워크상의 서버와 통신|
|VPC 피어링|접속을 허가한 다른 VPC상의 리소스와 통신|

**라우팅 연결 전**<br>
<img src="https://github.com/joyfulviper/aws/assets/79970349/da95a7da-76d3-42b5-82f5-91617ebf25d5" width="500" height="300">
<br><br>
**라우팅 연결 후**<br>
<img src="https://github.com/joyfulviper/aws/assets/79970349/843d5fe4-6a69-434b-b9e8-016c98c5bb13" width="500" height="300">

## 보안 그룹
- VPC 내의 리소스를 보호하기 위해 외부로부터 접근에 제한을 걸어 두는 기능
- 포트번호, IP주소를 통해 접근을 제한할 수 있음

## 점프 서버
- 리소스에 접근할 수 있는 입구 서버
- 점프 서버는 EC2를 이용해 구축할 수 있음
- EC2는 가상 서버로 CPU, 메모리, 디스크 등이 제공되며 리눅스나 윈도우 등의 OS를 설치 가능함

## SSH 접속에 필요한 키 페어 준비
- 점프 서버나 기타 서버로의 접속 방법은 OS 종류에 따라 다양하다. 가장 일반적인 방법인 ssh를 이용해 접속하겠다.
- 먼저 ec2 대시보드에서 키 페이럴 .pem 확장자로 생성하고 다운로드 받는다.

## EC2 인스턴스 생성
- 다음으로 EC2 인스턴스를 생성한다.
- AMI(Amazon Machine Image)는 AWS가 추천하는 AMI나 AMI-Kernal 5.10, SSD Volume Type을 선택한다.
- 적절한 인스턴스 유형을 생성한다.
- 네트워크 설정에서 퍼블릭 IP 자동 할당을 활성화, 네트워크는 앞서 작성한 VPC, 서브넷은 앞서 작성한 public01로 설정, 보안 그룹은 앞서 작성한 점프 서버용 보안그룹인 sample-sg-bastion을 설정한다.
- 스토리지도 적절한 스토리지를 설정한다.
- 키 페어는 위에서 생성한 키 페어로 설정하고 EC2 인스턴스를 생성한다.

## 접속하기
- open ssh가 설치 되어있는 환경에서 해당 ec2 인스턴스에 접근한다.
- 접근 방법은 ec2 대시보드에서 접속할 ec2 링크에 들어가 연결 페이지에 접속하면 접속하는 ssh 명령어가 있다.
- 보안그룹은 

